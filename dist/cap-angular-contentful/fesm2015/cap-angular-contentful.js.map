{"version":3,"file":"cap-angular-contentful.js","sources":["ng://cap-angular-contentful/lib/services/config.service.ts","ng://cap-angular-contentful/lib/services/contentful.service.ts","ng://cap-angular-contentful/lib/contentful.module.ts","ng://cap-angular-contentful/public-api.ts","ng://cap-angular-contentful/cap-angular-contentful.ts"],"sourcesContent":["import { Injectable, Optional } from '@angular/core';\r\nimport { IConfig } from '../interfaces/config.interface';\r\n\r\n@Injectable()\r\nexport class ConfigService {\r\n  accessToken: string;\r\n  space: string;\r\n  environment: string;\r\n\r\n  constructor(@Optional() config: IConfig) {\r\n    if (config) {\r\n      this.accessToken = config.accessToken;\r\n      this.space = config.space;\r\n      this.environment = config.environment;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, pipe, throwError } from 'rxjs';\r\nimport { map, catchError, tap } from 'rxjs/operators';\r\nimport { ConfigService } from './config.service';\r\n\r\n\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class CapContentfulService {\r\n\r\n    private actionUrl: string;\r\n    private httpOptions: any;\r\n\r\n    constructor(\r\n        private _http: HttpClient, \r\n        private configService: ConfigService\r\n    ) {\r\n        this.httpOptions = {\r\n            headers: new HttpHeaders({ \r\n                'Authorization': `Bearer ${this.configService.accessToken}`,\r\n                'Content-Type': 'application/vnd.contentful.delivery.v1+json'\r\n            }),\r\n            observe: \"response\"\r\n        };\r\n        this.actionUrl = `https://cdn.contentful.com/spaces/${this.configService.space}/environments/${this.configService.environment}/`;\r\n    }\r\n\r\n    responseWithRelatedAssets(response: any, relatedAssetKey: string[]): any {\r\n        if (!response.includes || \r\n            !response.includes.Asset ||\r\n            !response.items) {\r\n            return response;\r\n        }\r\n        const includes = response.includes.Asset;\r\n        const items = response.items;\r\n\r\n        // By each item must be know his related Asset\r\n        let newItems = [];\r\n        items.map(item => {\r\n            relatedAssetKey.map(key => {\r\n                // Search and replace by a include file\r\n                let file = includes.filter(a => a.sys.id === item.fields[key].sys.id)[0].fields;\r\n                const fileClone = file;\r\n                file = file.file;            \r\n                file['title'] = fileClone.title || '';\r\n                file['description'] = fileClone.description || '';\r\n                item.fields[key] =  {...item.fields[key], file};\r\n                newItems = [...newItems, item];\r\n            });\r\n        });\r\n        response.items = newItems;\r\n        return response.items;\r\n    }\r\n\r\n    getItems(contentType: string, relatedAssetKey?: string[]): Observable<any> {\r\n        const _url = `${this.actionUrl}entries?content_type=${contentType}`;\r\n        return this._http.get<any>(_url, this.httpOptions)\r\n        .pipe(\r\n            map((response: any) => response.body),\r\n            tap((response: any) => {\r\n                if (relatedAssetKey) {\r\n                    return this.responseWithRelatedAssets(response, relatedAssetKey);\r\n                } else {\r\n                    return response;\r\n                }\r\n            }),\r\n            catchError(error => this.handleError(error))\r\n        );\r\n    }\r\n\r\n    getItemById(contentType: string, id: string, relatedAssetKey?: string[]): Observable<any> {\r\n        const _url = `${this.actionUrl}entries?content_type=${contentType}&fields.id=${id}`;\r\n        return this._http.get<any>(_url, this.httpOptions)\r\n        .pipe(\r\n            map((response: any) => response.body),\r\n            tap((response: any) => {\r\n                if (relatedAssetKey) {\r\n                    return this.responseWithRelatedAssets(response, relatedAssetKey);\r\n                } else {\r\n                    return response;\r\n                }\r\n            }),\r\n            catchError(error => this.handleError(error))\r\n        );\r\n    }\r\n\r\n    private handleError(error: any) {\r\n        console.error(error);\r\n        return throwError(error || 'Server error');\r\n    }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { ConfigService } from './services/config.service';\r\nimport { IConfig } from './interfaces/config.interface';\r\nimport { CapContentfulService } from './services/contentful.service';\r\nimport { CommonModule } from \"@angular/common\";\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n  ],\r\n  imports: [\r\n    HttpClientModule,\r\n    CommonModule,\r\n  ],\r\n  exports: [\r\n  ],\r\n  providers: [\r\n    CapContentfulService\r\n  ],\r\n  schemas: [\r\n  ]\r\n})\r\nexport class CapContentfulModule {\r\n  static forRoot(config: IConfig): ModuleWithProviders<CapContentfulModule> {\r\n    return {\r\n      ngModule: CapContentfulModule,\r\n      providers: [\r\n        {\r\n          provide: ConfigService,\r\n          useValue: config\r\n        },\r\n      ]\r\n    };\r\n  }\r\n}\r\n\r\n","/*\r\n * Public API Surface of cap-contentful\r\n */\r\nexport * from './lib/contentful.module';\r\nexport * from './lib/services/contentful.service';\r\nexport * from './lib/services/config.service';\r\nexport * from './lib/interfaces/config.interface';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["tslib_1.__param"],"mappings":"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"}